/* =======================================================
   LED Backpack Animator v2.1 â€” style.css
   Implements UI/UX Spec: Glassmorphism, Purple/Teal Accents, Mobile-First
======================================================= */

/* 1) Visual Language */
:root {
  /* Core */
  --ink: #eaeefc;              /* primary text on dark */
  --ink-dim: #b9c2e8;          /* secondary text */
  --bg-0: #0c0f16;             /* page background */
  --bg-1: rgba(16, 18, 24, 0.6);   /* glass base */
  --border: rgba(120, 160, 255, 0.14);

  /* Accents */
  --accent: #73b7ff;           /* primary accent (blue) */
  --accent-2: #ff5cf0;         /* secondary accent (magenta) */
  --ok: #3ad29f;               /* success */
  --warn: #ffc555;             /* warnings & heads-ups */
  --danger: #ff4d4d;           /* destructive / delete X */
  --primary: var(--accent);

  /* Canvas & grid */
  --grid-on: rgba(255, 255, 255, 0.06);
  --grid-sel: rgba(255, 92, 240, 0.6);   /* magenta selection glow */
  --caret: var(--accent-2);
  --caret-dim: #7f2e78;

  /* Shadows & blurs */
  --glass-blur: 16px;
  --elev-1: 0 10px 30px rgba(10, 12, 20, 0.25);
  --elev-2: 0 14px 40px rgba(10, 12, 20, 0.32);

  /* Radii & spacing */
  --r-xl: 18px;
  --r-lg: 14px;
  --r-md: 10px;
  --space-1: 6px;
  --space-2: 10px;
  --space-3: 16px;
  --space-4: 24px;

  /* Focus ring */
  --focus: 0 0 0 3px rgba(115, 183, 255, 0.35);
}

/* Global Reset & Body */
* { box-sizing: border-box; }
html, body { height: 100%; margin: 0; padding: 0; }
body.theme-midnight {
  background: radial-gradient(1200px 800px at 50% -20%, #1a1f2e 0%, var(--bg-0) 60%) fixed;
  color: var(--ink);
  font: 16px/1.45 'Inter', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  overflow-x: hidden;
  display: flex;
  flex-direction: column;
}

/* Typography & Helpers */
.label { font-size: 14px; font-weight: 500; color: var(--ink-dim); }
.dim { opacity: 0.6; pointer-events: none; }
.hidden { display: none !important; }
.danger { color: #fff; background: var(--danger); }
.primary { background: var(--primary); color: var(--bg-0); }
.render-warn {
    font-size: 12px; color: var(--warn); padding: var(--space-1) var(--space-2);
    border: 1px solid rgba(var(--warn), 0.35); background: rgba(var(--warn), 0.05);
    border-radius: var(--r-md); margin-top: var(--space-1);
}

/* Glassmorphism Shell */
.glass {
  background: var(--bg-1);
  backdrop-filter: blur(var(--glass-blur));
  border: 1px solid var(--border);
  border-radius: var(--r-xl);
  box-shadow: var(--elev-1);
  padding: var(--space-3);
  margin-bottom: var(--space-3);
}

/* 3) Components & Behaviors */

/* === Toolbar v2 (Sticky Header) === */
.topbar {
    position: sticky; top: 0; z-index: 50;
    background: rgba(16, 18, 24, 0.8); /* Opaque background for glass on glass */
    backdrop-filter: blur(8px);
    border-bottom: 1px solid var(--border);
    border-radius: 0 0 var(--r-xl) var(--r-xl);
    padding: var(--space-2) var(--space-3);
    box-shadow: var(--elev-1);
    margin-bottom: 0; /* Override glass margin */
}
.toolbar-row { display: flex; align-items: center; justify-content: space-between; gap: var(--space-2); }
.brand { display: flex; align-items: center; gap: var(--space-2); }
.app-title { font-size: 18px; font-weight: 600; margin: 0; }
.ver-badge { font-size: 12px; font-weight: 500; color: var(--accent); }
.toolbar-actions { display: flex; gap: var(--space-2); flex-wrap: wrap; }

/* Buttons & Pills */
button {
    font-family: inherit; font-size: 14px; font-weight: 500;
    padding: 8px 12px; border-radius: var(--r-md);
    border: 1px solid transparent; cursor: pointer;
    background: rgba(255, 255, 255, 0.08); color: var(--ink);
    transition: background 120ms, box-shadow 120ms;
    min-height: 44px; /* Touch target */
}
button:hover { background: rgba(255, 255, 255, 0.15); }
button:focus { outline: none; box-shadow: var(--focus); }
button.active, .pill.active {
    border-color: var(--accent);
    box-shadow: 0 0 0 1px var(--accent-2);
    background: rgba(115, 183, 255, 0.1);
}
.icon-btn { padding: 8px; font-size: 16px; min-width: 44px; }
.pill { padding: 8px 12px; border-radius: 99px; }

/* === Main Layout === */
.layout {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
    padding: var(--space-3);
    max-width: 1200px;
    margin: 0 auto;
    width: 100%;
}

/* === Background & Resolution Panel (A5) === */
#bg-res {
    padding: var(--space-3);
}
.res-bar, .type-tabs { display: flex; align-items: center; gap: var(--space-2); margin-bottom: var(--space-2); flex-wrap: wrap; }
.custom-res { display: flex; align-items: center; gap: 4px; }
.custom-res input {
    width: 60px; text-align: center; background: rgba(0, 0, 0, 0.2);
    border: 1px solid var(--border); border-radius: var(--r-md); padding: 8px 4px;
    color: var(--ink); font-family: monospace;
}
.type-tabs .tab { background: none; border: none; border-radius: var(--r-md) var(--r-md) 0 0; }
.type-tabs .tab.active {
    background: var(--bg-1);
    border: 1px solid var(--border);
    border-bottom: 1px solid var(--bg-1); /* Hide bottom border */
    position: relative; z-index: 10;
}
.bg-content-area {
    min-height: 80px;
    border-top: 1px solid var(--border);
    padding-top: var(--space-3);
    position: relative;
}

/* === Control Bar (A4) === */
.controls {
    display: flex; flex-direction: column;
    gap: var(--space-2);
    padding: 0 var(--space-2); /* Less padding here, centered on desktop */
}
.controls .row1, .controls .row2 { display: flex; justify-content: space-between; align-items: center; }
.mode-toggle { display: flex; }
.mode-toggle .pill { border-radius: var(--r-md); }
.mode-toggle .pill:first-child { border-top-right-radius: 0; border-bottom-right-radius: 0; }
.mode-toggle .pill:last-child { border-top-left-radius: 0; border-bottom-left-radius: 0; }

.zoom-tools { display: flex; align-items: center; gap: var(--space-2); }
#zoom { width: 100px; }
#zoomReadout { font-family: monospace; font-size: 14px; }

/* === Canvas Stage (A1) === */
.stage {
    display: flex; justify-content: center;
    padding: var(--space-3) 0;
    position: relative; /* For caret/selection positioning if using absolute div */
}
.canvas-wrap {
    background: #000;
    outline: none; /* Focus handled by custom glow */
    border: 2px solid transparent;
    transition: border-color 200ms;
    cursor: text;
    line-height: 0; /* Prevent unwanted space below canvas */
}
.canvas-wrap:focus, .canvas-wrap.focused {
    border-color: var(--accent);
    box-shadow: 0 0 20px rgba(115, 183, 255, 0.3);
}

/* === Word Tools Row === */
.word-tools {
    display: flex; gap: var(--space-2);
    overflow-x: auto; /* Mobile scrollable row */
    padding: 0 var(--space-3);
    -webkit-overflow-scrolling: touch;
}
.word-tools .pill { white-space: nowrap; }

/* === Inspector Drawer (A6) === */
.inspector {
    position: sticky; bottom: 0; z-index: 40;
    padding: 0; border-radius: var(--r-xl) var(--r-xl) 0 0;
    overflow: hidden;
    margin-bottom: 0;
    border: 1px solid var(--border);
    border-bottom: none;
}
.pill-bar {
    display: flex; gap: var(--space-2); padding: var(--space-2) var(--space-3);
    border-bottom: 1px solid var(--border);
    overflow-x: auto;
}
.inspector-content {
    max-height: 400px; /* Limit height on desktop */
    padding: var(--space-3);
    transition: max-height 250ms ease-out;
}

/* === Preview Pane (A9) === */
#previewPane {
    display: flex; flex-direction: column; align-items: center;
}
.summary-chips { display: flex; gap: var(--space-2); margin-bottom: var(--space-3); flex-wrap: wrap; }
.summary-chips .pill { font-size: 12px; padding: 4px 8px; cursor: pointer; }
.preview {
    background: #000; border: 1px solid #333;
    padding: 4px; margin-bottom: var(--space-2);
}
#gifPreview { max-width: 100%; height: auto; display: block; }
.download-bar { margin-top: var(--space-3); display: flex; gap: var(--space-2); }
.download-bar .pill.primary { background: var(--ok); }

/* === Modals (A6, A8) === */
.modal-overlay {
    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(10, 12, 20, 0.8);
    backdrop-filter: blur(4px);
    z-index: 100;
    display: flex; align-items: center; justify-content: center;
    padding: var(--space-4);
}
.modal {
    width: 100%; max-width: 700px;
    padding: var(--space-4);
    box-shadow: var(--elev-2);
    overflow: auto;
}
.emoji-modal { max-width: 90vw; max-height: 90vh; }
.modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-3); }
.emoji-controls { display: flex; gap: var(--space-2); align-items: center; flex-wrap: wrap; }
#emojiTypeFilter, #emojiSearch {
    padding: 8px 12px; border: 1px solid var(--border);
    background: rgba(0, 0, 0, 0.2); color: var(--ink); border-radius: var(--r-md);
}
.emoji-pager { display: flex; align-items: center; gap: 8px; font-size: 14px; }
#emojiGrid {
    display: grid; grid-template-columns: repeat(auto-fill, minmax(44px, 1fr));
    gap: 8px; padding-top: var(--space-2);
    max-height: calc(90vh - 150px); overflow-y: auto;
}
.emoji-grid button {
    font-size: 28px; background: rgba(255, 255, 255, 0.05);
    min-width: 44px; min-height: 44px; padding: 0;
    display: flex; align-items: center; justify-content: center;
}

/* =======================================================
   Media Queries (Desktop Friendly)
======================================================= */
@media (min-width: 768px) {
    .layout {
        display: grid;
        grid-template-areas:
            "bg      bg"
            "control canvas"
            "tools   canvas"
            "insp    insp"
            "preview preview";
        grid-template-columns: 350px 1fr;
    }
    #bg-res { grid-area: bg; margin-bottom: 0; }
    .controls { grid-area: control; padding: 0; }
    .word-tools { grid-area: tools; padding: 0; flex-direction: column; gap: var(--space-1); }
    .word-tools .pill { width: 100%; }
    .stage { grid-area: canvas; padding: 0; }
    .inspector { grid-area: insp; border-radius: var(--r-xl); }
    #previewPane { grid-area: preview; }
    
    .inspector {
        position: static; /* No longer a sticky drawer */
        border-bottom: 1px solid var(--border);
    }
    .inspector-content {
        max-height: 400px;
    }
}

/* ------------------ Canvas & Caret Styling ------------------ */

@keyframes blink-caret {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
}

.blinking-caret {
    animation: blink-caret 0.8s step-end infinite;
}

/* ===== Theme (Content Omitted for Brevity) ===== */
:root{
  --bg: #0b0f16;
  --panel: #121826;
  --glass: rgba(255,255,255,0.04);
  --text: #e9edfb;
  --muted: #9aa5bd;

  --accent: #a675ff;
  --accent-strong: #be8cff;
  --primary: #7b86ff;
  --danger: #ff6b8b;

  --grad-start: #ff6bd6;
  --grad-end:   #6f79ff;

  --ring: rgba(166,117,255,0.45);
  --shadow: 0 14px 40px rgba(0,0,0,0.55);
  --radius: 16px;
  --radius-sm: 12px;
}

* { box-sizing: border-box; }
html, body { height: 100%; }
body.theme-midnight{
  margin:0; padding:0;
  background: radial-gradient(1200px 800px at 50% -20%, #1a1f2e 0%, #0b0f16 60%) fixed;
  color: var(--text);
  font: 16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Inter, sans-serif;
  overflow-x:hidden; /* prevent horizontal scroll on iPhone */
}

/* ... (Rest of existing CSS styles) ... */

/* ===== Text Editor Input for Live Editing - NEW ===== */
.text-editor {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 100; /* Above the canvas, but below modals */
    padding: 0;
    margin: 0;
    border: none;
    outline: none;
    background: transparent;
    color: var(--text); 
    caret-color: var(--accent-strong);
    /* FIX 1: Use 'pre' to preserve spaces and improve cursor position accuracy */
    white-space: pre; 
    overflow: hidden;
    font-family: 'Orbitron', sans-serif;
    font-size: 24px;
}

.text-editor:focus {
    /* FIX 2: Add a slight background when focused to ensure the input field is interactive */
    background: rgba(255, 255, 255, 0.05);
    box-shadow: none;
}

.text-editor:focus {
    /* Optional: Hide the selection border when input has focus, as we draw it on the canvas */
    box-shadow: none;
}

